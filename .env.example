# -----------------------------------------------------------------------------
# Arc — Root Environment Example
# Copy to .env and adjust values for your machine.
#
# Notes:
# - Server Go uses ARC_DATABASE_URL (if set) to enable Postgres store.
# - infra/compose.yml currently maps Postgres to host port 5433 when 5432 is busy.
# - Keep secrets out of git. This file is safe as an example.
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# Runtime
# -----------------------------------------------------------------------------
ARC_ENV=development
ARC_LOG_LEVEL=info

# A stable node id is useful later (tracing, message ids, multi-node)
ARC_NODE_ID=local

# -----------------------------------------------------------------------------
# HTTP Server
# -----------------------------------------------------------------------------
ARC_HTTP_ADDR=0.0.0.0:8080

# Optional HTTP hardening / performance (defaults exist in code)
ARC_HTTP_READ_HEADER_TIMEOUT=5s
ARC_HTTP_READ_TIMEOUT=15s
ARC_HTTP_WRITE_TIMEOUT=15s
ARC_HTTP_IDLE_TIMEOUT=60s
ARC_HTTP_MAX_HEADER_BYTES=1048576

# Readiness behavior:
# - false: /readyz is OK even without DB
# - true:  /readyz returns 503 unless DB is configured and reachable
ARC_READINESS_REQUIRE_DB=true

# -----------------------------------------------------------------------------
# Postgres (host-run defaults)
# -----------------------------------------------------------------------------
POSTGRES_HOST=127.0.0.1

# IMPORTANT:
# - If you run infra compose, your Postgres is currently mapped to 5433 on host.
# - If you stop brew Postgres and free 5432, you can set this back to 5432.
POSTGRES_PORT=5433

POSTGRES_DB=arc
POSTGRES_USER=arc
POSTGRES_PASSWORD=arc_dev_password

# Server Go uses this URL (preferred, authoritative)
# sslmode=disable is correct for local dev.
ARC_DATABASE_URL=postgres://arc:arc_dev_password@127.0.0.1:5433/arc?sslmode=disable

# Pool tuning (optional)
ARC_DB_MAX_CONNS=10
ARC_DB_MIN_CONNS=0

# Optional timeouts (if your db layer supports them; safe defaults for future)
ARC_DB_CONN_TIMEOUT=5s
ARC_DB_QUERY_TIMEOUT=10s

# -----------------------------------------------------------------------------
# Atlas (schema management) — REQUIRED for `atlas schema apply --env local`
# -----------------------------------------------------------------------------
# Target DB (the one the app connects to).
# We keep this separate from ARC_DATABASE_URL so schema management is explicit.
ARC_ATLAS_URL=postgres://arc:arc_dev_password@127.0.0.1:5433/arc?sslmode=disable&search_path=arc

# Dev database used by Atlas to compute diffs safely.
# Atlas provisions this automatically via Docker.
ARC_ATLAS_DEV_URL=docker://postgres/16/dev?search_path=arc

# -----------------------------------------------------------------------------
# Redis (future; not used by Go server yet)
# -----------------------------------------------------------------------------
REDIS_HOST=127.0.0.1
REDIS_PORT=6379

# -----------------------------------------------------------------------------
# WebSocket Gateway (PR-001/PR-002)
# -----------------------------------------------------------------------------

# DEV ONLY:
# - true allows insecure dev behavior (origin relaxed if allowlist empty, etc.)
# - false is stricter (recommended for staging/prod)
ARC_WS_DEV_INSECURE=false

# Origin policy
ARC_WS_ORIGIN_REQUIRED=false
# Comma-separated allowlist. Examples:
# ARC_WS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000
ARC_WS_ALLOWED_ORIGINS=

# IO tuning
ARC_WS_WRITE_TIMEOUT=5s
ARC_WS_READ_IDLE_TIMEOUT=2m
ARC_WS_SEND_QUEUE=256

# Heartbeat
ARC_WS_HEARTBEAT_INTERVAL=25s
ARC_WS_HEARTBEAT_TIMEOUT=5s

# Rate limiting (events per window, per connection)
ARC_WS_RATE_EVENTS=120
ARC_WS_RATE_WINDOW=10s

# Require auth token for WS (recommended in prod)
ARC_WS_REQUIRE_AUTH=true
# Require DB-backed membership check for joins/history/send
ARC_WS_REQUIRE_MEMBERSHIP=true

# -----------------------------------------------------------------------------
# Auth / Sessions (ADR-0003 / PR-004 / PR-005)
# -----------------------------------------------------------------------------
# REQUIRED when DB-enabled auth is in use:
# Provide a PASETO v4.public (Ed25519) secret key hex (64 bytes / 128 hex chars).
ARC_PASETO_V4_SECRET_KEY_HEX=CHANGE_ME

# Optional auth/session tuning:
ARC_AUTH_ISSUER=arc
ARC_AUTH_ACCESS_TTL=15m
ARC_AUTH_REFRESH_TTL_WEB=168h
ARC_AUTH_REFRESH_TTL_NATIVE=1440h
ARC_AUTH_REFRESH_TTL_NATIVE_SHORT=336h
ARC_AUTH_CLOCK_SKEW=30s
ARC_AUTH_REFRESH_TOKEN_BYTES=32

# Invite policy
ARC_AUTH_INVITE_ONLY=true
ARC_AUTH_INVITE_TTL=168h
ARC_AUTH_INVITE_TTL_MAX=720h
ARC_AUTH_INVITE_MAX_USES=1
ARC_AUTH_INVITE_MAX_USES_MAX=50

# Auth API guardrails
ARC_AUTH_MAX_BODY_BYTES=1048576
ARC_AUTH_TRUST_PROXY=false

# Login rate limiting (IP + user-based) and progressive lockout
ARC_AUTH_LOGIN_IP_MAX=20
ARC_AUTH_LOGIN_IP_WINDOW=5m
ARC_AUTH_LOGIN_USER_MAX=5
ARC_AUTH_LOGIN_USER_WINDOW=15m
ARC_AUTH_LOGIN_LOCKOUT_SHORT_THRESHOLD=5
ARC_AUTH_LOGIN_LOCKOUT_SHORT_DURATION=5m
ARC_AUTH_LOGIN_LOCKOUT_LONG_THRESHOLD=10
ARC_AUTH_LOGIN_LOCKOUT_LONG_DURATION=30m
ARC_AUTH_LOGIN_LOCKOUT_SEVERE_THRESHOLD=20
ARC_AUTH_LOGIN_LOCKOUT_SEVERE_DURATION=2h

# Security policy (refresh-token hashing)
ARC_REQUIRE_TOKEN_HMAC=false
ARC_TOKEN_HMAC_KEY=
