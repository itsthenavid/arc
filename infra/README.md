# Infrastructure

`infra/compose.yml` is the canonical local infrastructure definition for Arc.

## Services

- PostgreSQL (`postgres:16-alpine`)
- Redis (`redis:7-alpine`)
- Optional devcontainer base service (`arc-dev`)

## Standard Entry Points

- Start infra: `bash tools/scripts/infra-up.sh`
- Stop infra: `bash tools/scripts/infra-down.sh`
- Apply schema: `bash tools/scripts/apply-schema.sh`
- Full smoke (memory + postgres): `bash tools/scripts/smoke-all.sh`

These scripts are the supported path for local development. They handle compose discovery, dynamic host ports, and local state files in `tools/.state`.

## Environment Resolution

Compose variables are resolved from the first available file in this order:

1. `infra/.env`
2. `.env`
3. `infra/.env.example`

This keeps fresh clones runnable while still allowing private overrides.

## Notes

- Default host ports:
  - PostgreSQL: `5433`
  - Redis: `6379`
- `infra-up.sh` retries transient compose startup failures (for example temporary registry/network timeouts).
- State generated by scripts:
  - `tools/.state/infra.env`
  - `tools/.state/smoke.json`
